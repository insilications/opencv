#
# This file is auto-generated. DO NOT EDIT
# Generated by: autospec.py
#
%define keepstatic 1
Name     : opencv
Version  : 4.5.2
Release  : 301
URL      : file:///aot/build/clearlinux/packages/opencv/opencv-v4.5.2.tar.gz
Source0  : file:///aot/build/clearlinux/packages/opencv/opencv-v4.5.2.tar.gz
Source1  : file:///aot/build/clearlinux/packages/opencv/opencv_contrib-v4.5.2.tar.gz
Summary  : Open Source Computer Vision Library
Group    : Development/Tools
License  : Apache-2.0 GPL-2.0 MIT
Requires: numpy
Requires: onnx
Requires: tensorflow
BuildRequires : Cython
BuildRequires : Cython-python
BuildRequires : ImageMagick-dev
BuildRequires : LuaJIT-dev
BuildRequires : LuaJIT-staticdev
BuildRequires : PyYAML
BuildRequires : Pygments
BuildRequires : SDL2
BuildRequires : SDL2-dev
BuildRequires : SDL2-staticdev
BuildRequires : SVT-AV1-dev
BuildRequires : SVT-AV1-staticdev
BuildRequires : SVT-HEVC-dev
BuildRequires : SVT-HEVC-staticdev
BuildRequires : Sphinx
BuildRequires : VTK-dev
BuildRequires : Vulkan-Headers
BuildRequires : Vulkan-Headers-dev
BuildRequires : Vulkan-Loader
BuildRequires : Vulkan-Loader-dev
BuildRequires : Vulkan-Tools
BuildRequires : Vulkan-ValidationLayers
BuildRequires : Z3-dev
BuildRequires : Z3-staticdev
BuildRequires : acl
BuildRequires : acl-dev
BuildRequires : acl-staticdev
BuildRequires : ade-data
BuildRequires : ade-dev
BuildRequires : alsa-firmware
BuildRequires : alsa-lib-dev
BuildRequires : alsa-lib-lib
BuildRequires : alsa-plugins
BuildRequires : alsa-plugins-lib
BuildRequires : alsa-tools
BuildRequires : alsa-ucm-conf
BuildRequires : alsa-utils
BuildRequires : apache-ant
BuildRequires : asciidoctor-dev
BuildRequires : beautifulsoup4
BuildRequires : binutils
BuildRequires : binutils-dev
BuildRequires : binutils-staticdev
BuildRequires : brotli
BuildRequires : brotli-dev
BuildRequires : brotli-staticdev
BuildRequires : buildreq-cmake
BuildRequires : buildreq-distutils3
BuildRequires : buildreq-qmake
BuildRequires : bzip2
BuildRequires : bzip2-dev
BuildRequires : bzip2-staticdev
BuildRequires : ca-certs
BuildRequires : ca-certs-static
BuildRequires : cairo
BuildRequires : cairo-dev
BuildRequires : cairo-lib
BuildRequires : clazy
BuildRequires : cmake
BuildRequires : compat-gcc-10
BuildRequires : compat-gcc-10-dev
BuildRequires : cppcheck
BuildRequires : curl-dev
BuildRequires : dav1d-dev
BuildRequires : dav1d-staticdev
BuildRequires : dbus
BuildRequires : dbus-broker
BuildRequires : dbus-dev
BuildRequires : dbus-glib
BuildRequires : dbus-glib-dev
BuildRequires : dbus-python
BuildRequires : doxygen
BuildRequires : e2fsprogs-dev
BuildRequires : eigen
BuildRequires : eigen-data
BuildRequires : eigen-dev
BuildRequires : elfutils-dev
BuildRequires : evtest
BuildRequires : expat-dev
BuildRequires : expat-dev32
BuildRequires : expat-staticdev
BuildRequires : extra-cmake-modules pkgconfig(OpenEXR)
BuildRequires : fftw-dev
BuildRequires : fftw-staticdev
BuildRequires : findutils
BuildRequires : flac-dev
BuildRequires : flac-staticdev
BuildRequires : fontconfig-data
BuildRequires : fontconfig-dev
BuildRequires : fontconfig-lib
BuildRequires : fontconfig-staticdev
BuildRequires : freetype-dev
BuildRequires : freetype-lib
BuildRequires : freetype-staticdev
BuildRequires : fribidi-dev
BuildRequires : fribidi-staticdev
BuildRequires : gcc
BuildRequires : gcc-dev
BuildRequires : gcc-dev32
BuildRequires : gcc-libgcc32
BuildRequires : gcc-libs-math
BuildRequires : gcc-libstdc++32
BuildRequires : gcc-libubsan
BuildRequires : gcc-locale
BuildRequires : gdal
BuildRequires : gdal-dev
BuildRequires : gdal-staticdev
BuildRequires : gdb
BuildRequires : gdb-dev
BuildRequires : gettext
BuildRequires : gflags-dev
BuildRequires : glib
BuildRequires : glib-bin
BuildRequires : glib-data
BuildRequires : glib-dev
BuildRequires : glib-dev32
BuildRequires : glib-lib
BuildRequires : glib-staticdev
BuildRequires : glibc
BuildRequires : glibc-dev
BuildRequires : glibc-dev32
BuildRequires : glibc-lib-avx2
BuildRequires : glibc-libc32
BuildRequires : glibc-staticdev
BuildRequires : glog-dev
BuildRequires : glu
BuildRequires : glu-dev
BuildRequires : gmp
BuildRequires : gmp-dev
BuildRequires : gmp-staticdev
BuildRequires : gnutls
BuildRequires : gnutls-dev
BuildRequires : googletest
BuildRequires : googletest-dev
BuildRequires : graphite
BuildRequires : graphite-dev
BuildRequires : graphite-staticdev
BuildRequires : gsm-dev
BuildRequires : gsm-staticdev
BuildRequires : gstreamer-dev
BuildRequires : gtk+-data
BuildRequires : gtk+-lib
BuildRequires : gtk3-dev
BuildRequires : gtk3-lib
BuildRequires : h5py
BuildRequires : harfbuzz-dev
BuildRequires : harfbuzz-lib
BuildRequires : harfbuzz-staticdev
BuildRequires : hdf5
BuildRequires : hdf5-dev
BuildRequires : hdf5-lib
BuildRequires : hdf5-openmpi
BuildRequires : hdf5-staticdev
BuildRequires : icu4c-lib
BuildRequires : jack2
BuildRequires : jack2-dev
BuildRequires : json-c-staticdev
BuildRequires : jsoncpp
BuildRequires : jsoncpp-dev
BuildRequires : jsoncpp-lib
BuildRequires : jsoncpp-staticdev
BuildRequires : keyutils
BuildRequires : keyutils-dev
BuildRequires : krb5
BuildRequires : krb5-dev
BuildRequires : l-smash-dev
BuildRequires : l-smash-staticdev
BuildRequires : ladspa_sdk-dev
BuildRequires : ladspa_sdk-staticdev
BuildRequires : lcms2-dev
BuildRequires : lcms2-staticdev
BuildRequires : libICE-dev
BuildRequires : libSM-dev
BuildRequires : libX11-data
BuildRequires : libX11-dev
BuildRequires : libX11-dev libICE-dev libSM-dev libXau-dev libXcomposite-dev libXcursor-dev libXdamage-dev libXdmcp-dev libXext-dev libXfixes-dev libXft-dev libXi-dev libXinerama-dev libXi-dev libXmu-dev libXpm-dev libXrandr-dev libXrender-dev libXres-dev libXScrnSaver-dev libXt-dev libXtst-dev libXv-dev libXxf86vm-dev
BuildRequires : libX11-lib
BuildRequires : libXScrnSaver
BuildRequires : libXScrnSaver-dev
BuildRequires : libXScrnSaver-lib
BuildRequires : libXau-dev
BuildRequires : libXau-lib
BuildRequires : libXcursor-dev
BuildRequires : libXcursor-lib
BuildRequires : libXdamage-dev
BuildRequires : libXdamage-lib
BuildRequires : libXdmcp-dev
BuildRequires : libXdmcp-lib
BuildRequires : libXext-dev
BuildRequires : libXext-lib
BuildRequires : libXfont2-dev
BuildRequires : libXft-dev
BuildRequires : libXft-lib
BuildRequires : libXi-dev
BuildRequires : libXi-lib
BuildRequires : libXrender-dev
BuildRequires : libXrender-lib
BuildRequires : libXtst-dev
BuildRequires : libXtst-lib
BuildRequires : libXxf86vm-dev
BuildRequires : libXxf86vm-dev32
BuildRequires : libXxf86vm-lib
BuildRequires : libaom-dev
BuildRequires : libaom-staticdev
BuildRequires : libarchive
BuildRequires : libarchive-dev
BuildRequires : libarchive-staticdev
BuildRequires : libass-dev
BuildRequires : libass-staticdev
BuildRequires : libatomic_ops-dev
BuildRequires : libatomic_ops-staticdev
BuildRequires : libbluray-dev
BuildRequires : libcap
BuildRequires : libcap-dev
BuildRequires : libcap-ng-dev
BuildRequires : libconfig-dev
BuildRequires : libconfig-staticdev
BuildRequires : libdrm
BuildRequires : libdrm-dev
BuildRequires : libdrm-lib
BuildRequires : libdrm-staticdev
BuildRequires : libedit
BuildRequires : libedit-dev
BuildRequires : libepoxy
BuildRequires : libepoxy-dev
BuildRequires : libepoxy-staticdev
BuildRequires : libfdk_aac-dev
BuildRequires : libfdk_aac-staticdev
BuildRequires : libffi
BuildRequires : libffi-dev
BuildRequires : libffi-staticdev
BuildRequires : libgcc1
BuildRequires : libgcrypt
BuildRequires : libgcrypt-dev
BuildRequires : libgpg-error
BuildRequires : libgpg-error-dev
BuildRequires : libgphoto2-dev
BuildRequires : libidn2
BuildRequires : libidn2-dev
BuildRequires : libidn2-staticdev
BuildRequires : libinput-data
BuildRequires : libinput-dev
BuildRequires : libinput-lib
BuildRequires : libinput-libexec
BuildRequires : libjpeg-turbo-dev
BuildRequires : libjpeg-turbo-staticdev
BuildRequires : libmp3lame-dev
BuildRequires : libmp3lame-staticdev
BuildRequires : libogg
BuildRequires : libogg-dev
BuildRequires : libogg-staticdev
BuildRequires : libpciaccess
BuildRequires : libpciaccess-dev
BuildRequires : libplacebo
BuildRequires : libplacebo-dev
BuildRequires : libplacebo-staticdev
BuildRequires : libpng
BuildRequires : libpng-dev
BuildRequires : libpng-lib
BuildRequires : libpng-staticdev
BuildRequires : librealsense-dev
BuildRequires : libsamplerate-dev
BuildRequires : libsamplerate-dev32
BuildRequires : libsamplerate-staticdev
BuildRequires : libsamplerate-staticdev32
BuildRequires : libsndfile-dev
BuildRequires : libsndfile-staticdev
BuildRequires : libsrt-dev
BuildRequires : libsrt-staticdev
BuildRequires : libstdc++
BuildRequires : libstdc++-dev
BuildRequires : libtasn1-dev
BuildRequires : libtasn1-staticdev
BuildRequires : libtheora-dev
BuildRequires : libtheora-staticdev
BuildRequires : libudfread-dev
BuildRequires : libudfread-staticdev
BuildRequires : libunistring-dev
BuildRequires : libunistring-staticdev
BuildRequires : libunwind
BuildRequires : libunwind-dev
BuildRequires : libusb
BuildRequires : libusb-dev
BuildRequires : libva
BuildRequires : libva-dev
BuildRequires : libva-intel-driver
BuildRequires : libva-lib
BuildRequires : libvapoursynth-dev
BuildRequires : libvapoursynth-staticdev
BuildRequires : libvdpau
BuildRequires : libvdpau-dev
BuildRequires : libvorbis
BuildRequires : libvorbis-dev
BuildRequires : libvorbis-staticdev
BuildRequires : libvpx-dev
BuildRequires : libvpx-staticdev
BuildRequires : libwebp
BuildRequires : libwebp-dev
BuildRequires : libwebp-staticdev
BuildRequires : libx264-dev
BuildRequires : libx264-staticdev
BuildRequires : libx265-dev
BuildRequires : libx265-staticdev
BuildRequires : libxcb-dev
BuildRequires : libxcb-lib
BuildRequires : libxkbcommon
BuildRequires : libxkbcommon-dev
BuildRequires : libxml2-dev
BuildRequires : libxml2-staticdev
BuildRequires : libxslt-bin
BuildRequires : libxslt-dev
BuildRequires : libxslt-staticdev
BuildRequires : libxvid-dev
BuildRequires : libxvid-staticdev
BuildRequires : libzimg-dev
BuildRequires : libzimg-staticdev
BuildRequires : llvm
BuildRequires : llvm-abi
BuildRequires : llvm-bin
BuildRequires : llvm-data
BuildRequires : llvm-dev
BuildRequires : llvm-lib
BuildRequires : llvm-libexec
BuildRequires : llvm-man
BuildRequires : llvm-staticdev
BuildRequires : lrzip-dev
BuildRequires : lrzip-staticdev
BuildRequires : lz4
BuildRequires : lz4-dev
BuildRequires : lz4-staticdev
BuildRequires : lzo
BuildRequires : lzo-dev
BuildRequires : lzo-staticdev
BuildRequires : md4c
BuildRequires : md4c-dev
BuildRequires : md4c-staticdev
BuildRequires : mediasdk-dev
BuildRequires : mesa
BuildRequires : mesa-demos
BuildRequires : mesa-dev
BuildRequires : mesa-lib
BuildRequires : mkl-dnn-dev
BuildRequires : mm-common-dev
BuildRequires : nasm
BuildRequires : nasm-bin
BuildRequires : ncurses-dev
BuildRequires : nettle
BuildRequires : nettle-dev
BuildRequires : nettle-staticdev
BuildRequires : ninja
BuildRequires : not-ffmpeg
BuildRequires : not-ffmpeg-dev
BuildRequires : numlockx
BuildRequires : numpy
BuildRequires : numpy-dev
BuildRequires : numpy-stl
BuildRequires : nv-codec-headers-dev
BuildRequires : ocl-icd-dev
BuildRequires : onemkl
BuildRequires : onemkl-dev
BuildRequires : onemkl-lib
BuildRequires : onnx
BuildRequires : openblas
BuildRequires : openblas-dev
BuildRequires : openblas-staticdev
BuildRequires : opencl-headers
BuildRequires : opencl-headers-data
BuildRequires : opencl-headers-dev
BuildRequires : opencv-dev
BuildRequires : openjdk11-dev
BuildRequires : openjdk13
BuildRequires : openjdk13-dev
BuildRequires : openjpeg
BuildRequires : openjpeg-dev
BuildRequires : openjpeg-staticdev
BuildRequires : openssl
BuildRequires : openssl-dev
BuildRequires : openssl-lib
BuildRequires : openssl-staticdev
BuildRequires : opus-dev
BuildRequires : opus-staticdev
BuildRequires : orc-dev
BuildRequires : orc-staticdev
BuildRequires : p11-kit
BuildRequires : p11-kit-dev
BuildRequires : pacrunner
BuildRequires : pacrunner-dev
BuildRequires : pango-lib
BuildRequires : pcre-dev
BuildRequires : pcre-staticdev
BuildRequires : pcre2-dev
BuildRequires : pcre2-staticdev
BuildRequires : perl
BuildRequires : perl(XML::Parser)
BuildRequires : perl-Config-General
BuildRequires : perl-Config-Tiny
BuildRequires : perl-Crypt-SSLeay
BuildRequires : perl-DBI
BuildRequires : perl-DateTime-TimeZone
BuildRequires : perl-Encode-Locale
BuildRequires : perl-Error
BuildRequires : perl-File-Listing
BuildRequires : perl-HTML-Parser
BuildRequires : perl-HTML-Tagset
BuildRequires : perl-HTTP-Cookies
BuildRequires : perl-HTTP-Date
BuildRequires : perl-HTTP-Message
BuildRequires : perl-HTTP-Negotiate
BuildRequires : perl-IO-HTML
BuildRequires : perl-LWP-MediaTypes
BuildRequires : perl-LWP-Protocol-https
BuildRequires : perl-Params-Validate
BuildRequires : perl-Test-Simple
BuildRequires : perl-Try-Tiny
BuildRequires : perl-URI
BuildRequires : perl-XML-NamespaceSupport
BuildRequires : perl-XML-Parser
BuildRequires : perl-libwww-perl
BuildRequires : perl-man
BuildRequires : pip
BuildRequires : pixman
BuildRequires : pixman-dev
BuildRequires : pixman-lib
BuildRequires : pixman-staticdev
BuildRequires : pkg-config
BuildRequires : pkg-config-dev
BuildRequires : pkgconfig(32expat)
BuildRequires : pkgconfig(32glib-2.0)
BuildRequires : pkgconfig(32ice)
BuildRequires : pkgconfig(32libsystemd)
BuildRequires : pkgconfig(32sm)
BuildRequires : pkgconfig(32x11)
BuildRequires : pkgconfig(Qt5Concurrent)
BuildRequires : pkgconfig(Qt5Core)
BuildRequires : pkgconfig(Qt5DBus)
BuildRequires : pkgconfig(Qt5Designer)
BuildRequires : pkgconfig(Qt5Gui)
BuildRequires : pkgconfig(Qt5Help)
BuildRequires : pkgconfig(Qt5Location)
BuildRequires : pkgconfig(Qt5Multimedia)
BuildRequires : pkgconfig(Qt5Network)
BuildRequires : pkgconfig(Qt5OpenGL)
BuildRequires : pkgconfig(Qt5Pdf)
BuildRequires : pkgconfig(Qt5PdfWidgets)
BuildRequires : pkgconfig(Qt5PrintSupport)
BuildRequires : pkgconfig(Qt5Qml)
BuildRequires : pkgconfig(Qt5Quick)
BuildRequires : pkgconfig(Qt5QuickControls2)
BuildRequires : pkgconfig(Qt5QuickTest)
BuildRequires : pkgconfig(Qt5QuickWidgets)
BuildRequires : pkgconfig(Qt5Script)
BuildRequires : pkgconfig(Qt5Sensors)
BuildRequires : pkgconfig(Qt5SerialPort)
BuildRequires : pkgconfig(Qt5Sql)
BuildRequires : pkgconfig(Qt5Svg)
BuildRequires : pkgconfig(Qt5Test)
BuildRequires : pkgconfig(Qt5WebChannel)
BuildRequires : pkgconfig(Qt5WebEngine)
BuildRequires : pkgconfig(Qt5WebEngineCore)
BuildRequires : pkgconfig(Qt5WebEngineWidgets)
BuildRequires : pkgconfig(Qt5WebSockets)
BuildRequires : pkgconfig(Qt5Widgets)
BuildRequires : pkgconfig(Qt5X11Extras)
BuildRequires : pkgconfig(Qt5Xml)
BuildRequires : pkgconfig(alsa)
BuildRequires : pkgconfig(alsa-topology)
BuildRequires : pkgconfig(dbus-1)
BuildRequires : pkgconfig(dri)
BuildRequires : pkgconfig(egl)
BuildRequires : pkgconfig(expat)
BuildRequires : pkgconfig(gbm)
BuildRequires : pkgconfig(gdm)
BuildRequires : pkgconfig(gl)
BuildRequires : pkgconfig(glesv1_cm)
BuildRequires : pkgconfig(glesv2)
BuildRequires : pkgconfig(glib-2.0)
BuildRequires : pkgconfig(glu)
BuildRequires : pkgconfig(gmock)
BuildRequires : pkgconfig(gmock_main)
BuildRequires : pkgconfig(gstreamer-video-1.0)
BuildRequires : pkgconfig(gtest)
BuildRequires : pkgconfig(gtest_main)
BuildRequires : pkgconfig(ibus-1.0)
BuildRequires : pkgconfig(ice)
BuildRequires : pkgconfig(libdrm)
BuildRequires : pkgconfig(libpng)
BuildRequires : pkgconfig(libpulse-simple)
BuildRequires : pkgconfig(libsystemd)
BuildRequires : pkgconfig(libudev)
BuildRequires : pkgconfig(libunwind)
BuildRequires : pkgconfig(libunwind-coredump)
BuildRequires : pkgconfig(libunwind-generic)
BuildRequires : pkgconfig(libunwind-ptrace)
BuildRequires : pkgconfig(libunwind-setjmp)
BuildRequires : pkgconfig(libusb-1.0)
BuildRequires : pkgconfig(osmesa)
BuildRequires : pkgconfig(samplerate)
BuildRequires : pkgconfig(sm)
BuildRequires : pkgconfig(systemd)
BuildRequires : pkgconfig(tesseract)
BuildRequires : pkgconfig(valgrind)
BuildRequires : pkgconfig(vulkan)
BuildRequires : pkgconfig(wayland-client)
BuildRequires : pkgconfig(wayland-cursor)
BuildRequires : pkgconfig(wayland-egl)
BuildRequires : pkgconfig(wayland-protocols)
BuildRequires : pkgconfig(wayland-scanner)
BuildRequires : pkgconfig(x11)
BuildRequires : pkgconfig(xatracker)
BuildRequires : pkgconfig(xcursor)
BuildRequires : pkgconfig(xext)
BuildRequires : pkgconfig(xextproto)
BuildRequires : pkgconfig(xi)
BuildRequires : pkgconfig(xinerama)
BuildRequires : pkgconfig(xkbcommon)
BuildRequires : pkgconfig(xmu)
BuildRequires : pkgconfig(xorg-macros)
BuildRequires : pkgconfig(xpm)
BuildRequires : pkgconfig(xproto)
BuildRequires : pkgconfig(xrandr)
BuildRequires : pkgconfig(xscrnsaver)
BuildRequires : pkgconfig(xt)
BuildRequires : pkgconfig(zlib)
BuildRequires : pluggy
BuildRequires : procps-ng
BuildRequires : protobuf-dev
BuildRequires : pugixml-dev
BuildRequires : pulseaudio
BuildRequires : pulseaudio-dev
BuildRequires : py-python
BuildRequires : pytest
BuildRequires : python-pkgconfig
BuildRequires : python3-core
BuildRequires : python3-dev
BuildRequires : python3-staticdev
BuildRequires : qca-qt5
BuildRequires : qca-qt5-dev
BuildRequires : qt3d
BuildRequires : qt3d-dev
BuildRequires : qt5ct
BuildRequires : qtbase
BuildRequires : qtbase-dev
BuildRequires : qtbase-dev mesa-dev
BuildRequires : qtbase-extras
BuildRequires : qtcanvas3d
BuildRequires : qtcharts
BuildRequires : qtcharts-dev
BuildRequires : qtconnectivity
BuildRequires : qtconnectivity-dev
BuildRequires : qtdatavis3d
BuildRequires : qtdatavis3d-dev
BuildRequires : qtdeclarative
BuildRequires : qtdeclarative-dev
BuildRequires : qtgamepad
BuildRequires : qtgamepad-dev
BuildRequires : qtgraphicaleffects
BuildRequires : qtimageformats
BuildRequires : qtlocation
BuildRequires : qtlocation-dev
BuildRequires : qtmqtt
BuildRequires : qtmqtt-dev
BuildRequires : qtmultimedia
BuildRequires : qtmultimedia-dev
BuildRequires : qtnetworkauth
BuildRequires : qtnetworkauth-dev
BuildRequires : qtquickcontrols
BuildRequires : qtquickcontrols2
BuildRequires : qtquickcontrols2-dev
BuildRequires : qtremoteobjects-dev
BuildRequires : qtscript
BuildRequires : qtscript-dev
BuildRequires : qtscript-extras
BuildRequires : qtscxml
BuildRequires : qtscxml-dev
BuildRequires : qtsensors
BuildRequires : qtsensors-dev
BuildRequires : qtserialbus
BuildRequires : qtserialbus-dev
BuildRequires : qtserialport
BuildRequires : qtserialport-dev
BuildRequires : qtspeech
BuildRequires : qtspeech-dev
BuildRequires : qtsvg
BuildRequires : qtsvg-dev
BuildRequires : qttools
BuildRequires : qttools-dev
BuildRequires : qttranslations
BuildRequires : qtvirtualkeyboard
BuildRequires : qtvirtualkeyboard-dev
BuildRequires : qtwayland
BuildRequires : qtwayland-dev
BuildRequires : qtwebchannel
BuildRequires : qtwebchannel-dev
BuildRequires : qtwebengine
BuildRequires : qtwebengine-dev
BuildRequires : qtwebsockets
BuildRequires : qtwebsockets-dev
BuildRequires : qtx11extras
BuildRequires : qtx11extras-dev
BuildRequires : qtxmlpatterns
BuildRequires : qtxmlpatterns-dev
BuildRequires : rtmpdump-dev
BuildRequires : rtmpdump-staticdev
BuildRequires : rubberband-dev
BuildRequires : rubberband-staticdev
BuildRequires : sed
BuildRequires : setxkbmap
BuildRequires : shaderc-dev
BuildRequires : shaderc-staticdev
BuildRequires : shared-mime-info
BuildRequires : six
BuildRequires : snappy-dev
BuildRequires : snappy-staticdev
BuildRequires : solid-dev
BuildRequires : sonnet-dev
BuildRequires : speex-dev
BuildRequires : speex-staticdev
BuildRequires : speexdsp-dev
BuildRequires : speexdsp-staticdev
BuildRequires : sqlite-autoconf
BuildRequires : sqlite-autoconf-dev
BuildRequires : sqlite-autoconf-staticdev
BuildRequires : syntax-highlighting
BuildRequires : syntax-highlighting-data
BuildRequires : syntax-highlighting-dev
BuildRequires : syntax-highlighting-lib
BuildRequires : systemd
BuildRequires : systemd-dev
BuildRequires : tensorflow
BuildRequires : tesseract
BuildRequires : tesseract-bin
BuildRequires : tesseract-data
BuildRequires : tesseract-dev
BuildRequires : texinfo
BuildRequires : tiff
BuildRequires : tiff-dev
BuildRequires : tiff-staticdev
BuildRequires : tox
BuildRequires : uchardet-dev
BuildRequires : uchardet-staticdev
BuildRequires : util-linux
BuildRequires : util-linux-dev
BuildRequires : util-linux-staticdev
BuildRequires : v4l-utils-dev
BuildRequires : valgrind
BuildRequires : valgrind-dev
BuildRequires : vamp-sdk-dev
BuildRequires : vamp-sdk-staticdev
BuildRequires : virtualenv
BuildRequires : wayland
BuildRequires : wayland-dev
BuildRequires : weston
BuildRequires : wmctrl
BuildRequires : xauth
BuildRequires : xcb-proto
BuildRequires : xcb-proto-dev
BuildRequires : xcb-util-cursor-dev
BuildRequires : xcb-util-dev
BuildRequires : xcb-util-image-dev
BuildRequires : xcb-util-keysyms-dev
BuildRequires : xcb-util-renderutil-dev
BuildRequires : xcb-util-wm-dev
BuildRequires : xcb-util-xrm-dev
BuildRequires : xclip
BuildRequires : xdg-dbus-proxy
BuildRequires : xdg-desktop-portal
BuildRequires : xdg-desktop-portal-dev
BuildRequires : xdg-desktop-portal-gtk
BuildRequires : xdg-desktop-portal-kde
BuildRequires : xdg-user-dirs
BuildRequires : xdg-user-dirs-gtk
BuildRequires : xdg-utils
BuildRequires : xdotool
BuildRequires : xdpyinfo
BuildRequires : xf86-input-libinput
BuildRequires : xf86-video-amdgpu
BuildRequires : xf86-video-ati
BuildRequires : xf86-video-fbdev
BuildRequires : xf86-video-nouveau
BuildRequires : xf86-video-qxl
BuildRequires : xf86-video-vboxvideo
BuildRequires : xf86-video-vesa
BuildRequires : xf86-video-vmware
BuildRequires : xfontsel
BuildRequires : xhost
BuildRequires : xinit
BuildRequires : xinput
BuildRequires : xkbcomp
BuildRequires : xkeyboard-config
BuildRequires : xkill
BuildRequires : xmodmap
BuildRequires : xorg-server
BuildRequires : xorg-server-dev
BuildRequires : xorgproto
BuildRequires : xorgproto-dev
BuildRequires : xprop
BuildRequires : xrandr
BuildRequires : xrdb
BuildRequires : xrdp
BuildRequires : xrestop
BuildRequires : xscreensaver
BuildRequires : xsel
BuildRequires : xset
BuildRequires : xsetroot
BuildRequires : xvfb-run
BuildRequires : xwd
BuildRequires : xwininfo
BuildRequires : xz
BuildRequires : xz-dev
BuildRequires : xz-staticdev
BuildRequires : yaml-cpp
BuildRequires : yaml-cpp-dev
BuildRequires : zlib
BuildRequires : zlib-dev
BuildRequires : zlib-staticdev
BuildRequires : zstd-dev
BuildRequires : zstd-staticdev
# Suppress stripping binaries
%define __strip /bin/true
%define debug_package %{nil}

%description
A demo of the Java wrapper for OpenCV with two examples:
1) feature detection and matching and
2) face detection.
The examples are coded in Scala and Java.
Anyone familiar with Java should be able to read the Scala examples.
Please feel free to contribute code examples in Scala or Java, or any JVM language.

%prep
echo 'intelpython=exclude' > /builddir/oneapi.txt
%setup -q -n opencv
cd %{_builddir}
tar xf %{_sourcedir}/opencv_contrib-v4.5.2.tar.gz
cd %{_builddir}/opencv
mkdir -p opencv_contrib
cp -r %{_builddir}/opencv_contrib/* %{_builddir}/opencv/opencv_contrib

%build
unset http_proxy
unset https_proxy
unset no_proxy
export SSL_CERT_FILE=/var/cache/ca-certs/anchors/ca-certificates.crt
export LANG=C.UTF-8
export SOURCE_DATE_EPOCH=1622546877
mkdir -p clr-build
pushd clr-build
export GCC_IGNORE_WERROR=1
## altflags_pgo content
## pgo generate
export PGO_GEN="-fprofile-generate=/var/tmp/pgo -fprofile-dir=/var/tmp/pgo -fprofile-abs-path -fprofile-update=atomic -fprofile-arcs -ftest-coverage --coverage -fprofile-partial-training"
export CFLAGS_GENERATE="-g -O3 --param=lto-max-streaming-parallelism=16 -march=native -mtune=native -falign-functions=32 -flimit-function-alignment -fno-semantic-interposition -fno-stack-protector -fuse-ld=bfd -fuse-linker-plugin -malign-data=cacheline -mtls-dialect=gnu2 -fno-math-errno -fno-trapping-math -pipe -ffat-lto-objects -flto=16 -fPIC -Wl,-z,max-page-size=0x1000 -fomit-frame-pointer -pthread -static-libstdc++ -static-libgcc -Wl,--build-id=sha1 -fdevirtualize-at-ltrans -Wl,-z,now -Wl,-z,relro -Wl,-sort-common -fasynchronous-unwind-tables $PGO_GEN"
export FCFLAGS_GENERATE="-g -O3 --param=lto-max-streaming-parallelism=16 -march=native -mtune=native -falign-functions=32 -flimit-function-alignment -fno-semantic-interposition -fno-stack-protector -fuse-ld=bfd -fuse-linker-plugin -malign-data=cacheline -mtls-dialect=gnu2 -fno-math-errno -fno-trapping-math -pipe -ffat-lto-objects -flto=16 -fPIC -Wl,-z,max-page-size=0x1000 -fomit-frame-pointer -pthread -static-libstdc++ -static-libgcc -Wl,--build-id=sha1 -fdevirtualize-at-ltrans -Wl,-z,now -Wl,-z,relro -Wl,-sort-common -fasynchronous-unwind-tables $PGO_GEN"
export FFLAGS_GENERATE="-g -O3 --param=lto-max-streaming-parallelism=16 -march=native -mtune=native -falign-functions=32 -flimit-function-alignment -fno-semantic-interposition -fno-stack-protector -fuse-ld=bfd -fuse-linker-plugin -malign-data=cacheline -mtls-dialect=gnu2 -fno-math-errno -fno-trapping-math -pipe -ffat-lto-objects -flto=16 -fPIC -Wl,-z,max-page-size=0x1000 -fomit-frame-pointer -pthread -static-libstdc++ -static-libgcc -Wl,--build-id=sha1 -fdevirtualize-at-ltrans -Wl,-z,now -Wl,-z,relro -Wl,-sort-common -fasynchronous-unwind-tables $PGO_GEN"
export CXXFLAGS_GENERATE="-g -O3 --param=lto-max-streaming-parallelism=16 -march=native -mtune=native -falign-functions=32 -flimit-function-alignment -fno-semantic-interposition -fno-stack-protector -fuse-ld=bfd -fuse-linker-plugin -malign-data=cacheline -mtls-dialect=gnu2 -fno-math-errno -fno-trapping-math -fvisibility-inlines-hidden -pipe -ffat-lto-objects -flto=16 -fPIC -Wl,-z,max-page-size=0x1000 -fomit-frame-pointer -pthread -static-libstdc++ -static-libgcc -Wl,--build-id=sha1 -fdevirtualize-at-ltrans -Wl,-z,now -Wl,-z,relro -Wl,-sort-common -fasynchronous-unwind-tables $PGO_GEN"
export LDFLAGS_GENERATE="-g -O3 --param=lto-max-streaming-parallelism=16 -march=native -mtune=native -falign-functions=32 -flimit-function-alignment -fno-semantic-interposition -fno-stack-protector -fuse-ld=bfd -fuse-linker-plugin -malign-data=cacheline -mtls-dialect=gnu2 -fno-math-errno -fno-trapping-math -pipe -ffat-lto-objects -flto=16 -fPIC -Wl,-z,max-page-size=0x1000 -fomit-frame-pointer -pthread -static-libstdc++ -static-libgcc -lpthread -Wl,--build-id=sha1 -fdevirtualize-at-ltrans -Wl,-z,now -Wl,-z,relro -Wl,-sort-common -fasynchronous-unwind-tables $PGO_GEN"
## pgo use
## -ffat-lto-objects -fno-PIE -fno-PIE -m64 -no-pie -fPIC -Wl,-z,max-page-size=0x1000 -fvisibility=hidden -flto-partition=none
## gcc: -feliminate-unused-debug-types -fipa-pta -flto=16 -Wno-error -Wp,-D_REENTRANT -fno-common -funroll-loops
export PGO_USE="-fprofile-use=/var/tmp/pgo -fprofile-dir=/var/tmp/pgo -fprofile-abs-path -fprofile-correction -fprofile-partial-training"
export CFLAGS_USE="-g -O3 --param=lto-max-streaming-parallelism=16 -march=native -mtune=native -fgraphite-identity -Wall -Wl,--as-needed -Wl,--build-id=sha1 -Wl,--enable-new-dtags -Wl,--hash-style=gnu -Wl,-O2 -Wl,-z,now -Wl,-z,relro -falign-functions=32 -flimit-function-alignment -fasynchronous-unwind-tables -fdevirtualize-at-ltrans -floop-nest-optimize -floop-block -fno-math-errno -fno-semantic-interposition -fno-stack-protector -fno-trapping-math -ftree-loop-distribute-patterns -ftree-loop-vectorize -ftree-vectorize -fuse-ld=bfd -fuse-linker-plugin -malign-data=cacheline -feliminate-unused-debug-types -fipa-pta -flto=16 -fno-plt -mtls-dialect=gnu2 -Wl,-sort-common -Wno-error -Wp,-D_REENTRANT -pipe -ffat-lto-objects -fPIC -Wl,-z,max-page-size=0x1000 -fomit-frame-pointer -pthread -static-libstdc++ -static-libgcc $PGO_USE"
export FCFLAGS_USE="-g -O3 --param=lto-max-streaming-parallelism=16 -march=native -mtune=native -fgraphite-identity -Wall -Wl,--as-needed -Wl,--build-id=sha1 -Wl,--enable-new-dtags -Wl,--hash-style=gnu -Wl,-O2 -Wl,-z,now -Wl,-z,relro -falign-functions=32 -flimit-function-alignment -fasynchronous-unwind-tables -fdevirtualize-at-ltrans -floop-nest-optimize -floop-block -fno-math-errno -fno-semantic-interposition -fno-stack-protector -fno-trapping-math -ftree-loop-distribute-patterns -ftree-loop-vectorize -ftree-vectorize -fuse-ld=bfd -fuse-linker-plugin -malign-data=cacheline -feliminate-unused-debug-types -fipa-pta -flto=16 -fno-plt -mtls-dialect=gnu2 -Wl,-sort-common -Wno-error -Wp,-D_REENTRANT -pipe -ffat-lto-objects -fPIC -Wl,-z,max-page-size=0x1000 -fomit-frame-pointer -pthread -static-libstdc++ -static-libgcc $PGO_USE"
export FFLAGS_USE="-g -O3 --param=lto-max-streaming-parallelism=16 -march=native -mtune=native -fgraphite-identity -Wall -Wl,--as-needed -Wl,--build-id=sha1 -Wl,--enable-new-dtags -Wl,--hash-style=gnu -Wl,-O2 -Wl,-z,now -Wl,-z,relro -falign-functions=32 -flimit-function-alignment -fasynchronous-unwind-tables -fdevirtualize-at-ltrans -floop-nest-optimize -floop-block -fno-math-errno -fno-semantic-interposition -fno-stack-protector -fno-trapping-math -ftree-loop-distribute-patterns -ftree-loop-vectorize -ftree-vectorize -fuse-ld=bfd -fuse-linker-plugin -malign-data=cacheline -feliminate-unused-debug-types -fipa-pta -flto=16 -fno-plt -mtls-dialect=gnu2 -Wl,-sort-common -Wno-error -Wp,-D_REENTRANT -pipe -ffat-lto-objects -fPIC -Wl,-z,max-page-size=0x1000 -fomit-frame-pointer -pthread -static-libstdc++ -static-libgcc $PGO_USE"
export CXXFLAGS_USE="-g -O3 --param=lto-max-streaming-parallelism=16 -march=native -mtune=native -fgraphite-identity -Wall -Wl,--as-needed -Wl,--build-id=sha1 -Wl,--enable-new-dtags -Wl,--hash-style=gnu -Wl,-O2 -Wl,-z,now -Wl,-z,relro -falign-functions=32 -flimit-function-alignment -fasynchronous-unwind-tables -fdevirtualize-at-ltrans -floop-nest-optimize -floop-block -fno-math-errno -fno-semantic-interposition -fno-stack-protector -fno-trapping-math -ftree-loop-distribute-patterns -ftree-loop-vectorize -ftree-vectorize -fuse-ld=bfd -fuse-linker-plugin -malign-data=cacheline -feliminate-unused-debug-types -fipa-pta -flto=16 -fno-plt -mtls-dialect=gnu2 -Wl,-sort-common -Wno-error -Wp,-D_REENTRANT -fvisibility-inlines-hidden -pipe -ffat-lto-objects -fPIC -Wl,-z,max-page-size=0x1000 -fomit-frame-pointer -pthread -static-libstdc++ -static-libgcc $PGO_USE"
export LDFLAGS_USE="-g -O3 --param=lto-max-streaming-parallelism=16 -march=native -mtune=native -fgraphite-identity -Wall -Wl,--as-needed -Wl,--build-id=sha1 -Wl,--enable-new-dtags -Wl,--hash-style=gnu -Wl,-O2 -Wl,-z,now -Wl,-z,relro -falign-functions=32 -flimit-function-alignment -fasynchronous-unwind-tables -fdevirtualize-at-ltrans -floop-nest-optimize -floop-block -fno-math-errno -fno-semantic-interposition -fno-stack-protector -fno-trapping-math -ftree-loop-distribute-patterns -ftree-loop-vectorize -ftree-vectorize -fuse-ld=bfd -fuse-linker-plugin -malign-data=cacheline -feliminate-unused-debug-types -fipa-pta -flto=16 -fno-plt -mtls-dialect=gnu2 -Wl,-sort-common -Wno-error -Wp,-D_REENTRANT -pipe -ffat-lto-objects -fPIC -Wl,-z,max-page-size=0x1000 -fomit-frame-pointer -pthread -static-libstdc++ -static-libgcc -lpthread $PGO_USE"
#
export AR=/usr/bin/gcc-ar
export RANLIB=/usr/bin/gcc-ranlib
export NM=/usr/bin/gcc-nm
#
export MAKEFLAGS=%{?_smp_mflags}
#
export CCACHE_DISABLE=true
#
export LD_LIBRARY_PATH="/usr/nvidia/lib64:/usr/nvidia/lib:/usr/nvidia/lib/vdpau:/usr/nvidia/lib64/xorg/modules/drivers:/usr/nvidia/lib64/xorg/modules/extensions:/usr/local/cuda/lib64:/usr/lib64/dri:/usr/lib64/haswell:/usr/lib64:/usr/lib:/usr/share"
#
export PATH="/usr/nvidia/bin:/usr/bin/haswell:/usr/bin:/usr/sbin"
#
#export NVCC_PREPEND_FLAGS="-O3 -Xptxas -O3,-v -cudart=static -ccbin=/usr/bin/gcc-10 -Xcompiler -O3,-static,-march=native,-mtune=native,-flto=16,-fuse-linker-plugin,-ffat-lto-objects,-fasynchronous-unwind-tables -Xlinker -flto=16,-fuse-linker-plugin,-ffat-lto-objects,-march=native,-mtune=native,-static -Xarchive -flto=16,-fuse-linker-plugin,-march=native,-mtune=native,-static"
#-gencode;arch=compute_52,code=sm_52
#-DWITH_CUDA=ON -DWITH_NVCUVID=ON -DWITH_NVCUVENC=OFF -DBUILD_opencv_cudacodec=ON -DWITH_CUDNN=OFF -DOPENCV_DNN_CUDA=OFF -DENABLE_FAST_MATH=1 -DCUDA_FAST_MATH=1 -DWITH_CUBLAS=1 -DWITH_V4L=ON -DOPENCV_GENERATE_PKGCONFIG=ON -DOPENCV_PC_FILE_NAME=opencv4.pc
export VERBOSE=1
export V=1
## altflags_pgo end
set +x; source /aot/intel/oneapi/setvars.sh --config=/builddir/oneapi.txt; set -x
##
if [ ! -f statuspgo ]; then
echo PGO Phase 1
export CFLAGS="${CFLAGS_GENERATE}"
export CXXFLAGS="${CXXFLAGS_GENERATE}"
export FFLAGS="${FFLAGS_GENERATE}"
export FCFLAGS="${FCFLAGS_GENERATE}"
export LDFLAGS="${LDFLAGS_GENERATE}"
%cmake .. -GNinja \
-DBUILD_SHARED_LIBS:BOOL=OFF \
-DCMAKE_BUILD_TYPE=Release \
-DCMAKE_C_COMPILER=/usr/bin/gcc \
-DCMAKE_CXX_COMPILER=/usr/bin/g++ \
-DCMAKE_AR=/usr/bin/gcc-ar \
-DCMAKE_NM=/usr/bin/gcc-nm \
-DCMAKE_RANLIB=/usr/bin/gcc-ranlib \
-DCMAKE_INSTALL_LIBDIR:PATH=/usr/lib64 \
-DCMAKE_INSTALL_PREFIX=/usr \
-DCMAKE_JOB_POOL_COMPILE=full_jobs \
-DCMAKE_JOB_POOL_LINK=full_jobs \
-DCMAKE_JOB_POOLS=full_jobs=16 \
-DCMAKE_VERBOSE_MAKEFILE:BOOL:BOOL=ON \
-Dverbose:BOOL=ON \
-DVERBOSE:BOOL=ON \
-DVERBOSE=1 \
-DBUILD_opencv_python2:BOOL=OFF \
-DHAVE_opencv_python2:BOOL=OFF \
-DBUILD_opencv_python3:BOOL=ON \
-DHAVE_opencv_python3:BOOL=ON \
-DBUILD_opencv_java:BOOL=OFF \
-DCPU_BASELINE=AVX2 \
-DCPU_DISPATCH= \
-DCV_DISABLE_OPTIMIZATION:BOOL=OFF \
-DCV_ENABLE_INTRINSICS:BOOL=ON \
-DCV_TRACE:BOOL=OFF \
-DBUILD_DOCS:BOOL=OFF \
-DENABLE_CCACHE:BOOL=OFF \
-DENABLE_FAST_MATH:BOOL=OFF \
-DENABLE_PIC:BOOL=ON \
-DWITH_TBB:BOOL=ON \
-DMKL_WITH_TBB:BOOL=ON \
-DMKL_USE_SINGLE_DYNAMIC_LIBRARY:BOOL=OFF \
-DMKL_WITH_OPENMP:BOOL=OFF \
-DBUILD_TBB:BOOL=OFF \
-DOPENCV_DNN_CUDA:BOOL=ON \
-DOPENCV_DNN_OPENCL:BOOL=ON \
-DOPENCV_ENABLE_NONFREE:BOOL=ON \
-DOPENCV_GENERATE_PKGCONFIG:BOOL=ON \
-DOPENCV_PYTHON_INSTALL_PATH=/usr/lib/python3.9/site-packages \
-DPYTHON3_EXECUTABLE:FILEPATH=/usr/bin/python3 \
-DPython2_EXECUTABLE= \
-DPYTHON2_EXECUTABLE= \
-DPARALLEL_ENABLE_PLUGINS:BOOL=ON \
-DBUILD_PNG:BOOL=OFF \
-DBUILD_JAVA:BOOL=OFF \
-DWITH_1394:BOOL=OFF \
-DWITH_ADE:BOOL=ON \
-DWITH_CUDA:BOOL=ON \
-DWITH_NGRAPH:BOOL=OFF \
-DCUDAToolkit_ROOT=/usr/local/cuda \
-DCUDNN_INCLUDE_DIR=/usr/local/cuda/include \
-DCUDA_NVCC_FLAGS="-O3;-Xptxas;-O3,-v;-cudart=static;-Xcompiler;-O3,-march=native,-fuse-linker-plugin,-ffat-lto-objects,-fasynchronous-unwind-tables,-pthread,-static-libstdc++,-static-libgcc;-Xlinker;-O3,-march=native,-fuse-linker-plugin,-ffat-lto-objects,-fasynchronous-unwind-tables,-pthread,-static-libstdc++,-static-libgcc;-Xarchive;-O3,-march=native,-fuse-linker-plugin,-ffat-lto-objects,-fasynchronous-unwind-tables,-pthread,-static-libstdc++,-static-libgcc" \
-DCUDA_ARCH_BIN=5.2 \
-DCUDA_HOST_COMPILER=/usr/bin/gcc-10 \
-DCUDA_PROPAGATE_HOST_FLAGS:BOOL=OFF \
-DCUDA_VERBOSE_BUILD:BOOL=ON \
-DWITH_EIGEN:BOOL=ON \
-DWITH_FFMPEG:BOOL=ON \
-DWITH_FREETYPE:BOOL=ON \
-DWITH_GSTREAMER:BOOL=ON \
-DWITH_GTK:BOOL=OFF \
-DWITH_IMGCODEC_HDR:BOOL=ON \
-DWITH_IMGCODEC_PFM:BOOL=ON \
-DWITH_IMGCODEC_PXM:BOOL=ON \
-DWITH_IMGCODEC_SUNRASTER:BOOL=ON \
-DBUILD_IPP_IW:BOOL=OFF \
-DWITH_IPP:BOOL=ON \
-DIPPROOT=/aot/intel/oneapi/ipp/latest/ \
-DBUILD_WITH_DYNAMIC_IPP=OFF \
-DOPENCV_IPP_GAUSSIAN_BLUR:BOOL=ON \
-DWITH_ITT:BOOL=ON \
-DWITH_JASPER:BOOL=OFF \
-DWITH_JPEG:BOOL=ON \
-DWITH_LAPACK:BOOL=ON \
-DWITH_MFX:BOOL=OFF \
-DWITH_OPENCLAMDBLAS:BOOL=ON \
-DWITH_OPENCLAMDFFT:BOOL=ON \
-DWITH_OPENCL:BOOL=ON \
-DWITH_OPENCL_SVM:BOOL=ON \
-DWITH_OPENEXR:BOOL=OFF \
-DWITH_OPENGL:BOOL=ON \
-DOPENGL_egl_LIBRARY:FILEPATH=/usr/nvidia/lib64/libEGL.so \
-DOPENGL_gl_LIBRARY:FILEPATH=/usr/nvidia/lib64/libGL.so \
-DOPENGL_gles2_LIBRARY:FILEPATH=/usr/nvidia/lib64/libGLESv2.so \
-DOPENGL_gles3_LIBRARY:FILEPATH=/usr/nvidia/lib64/libGLESv2.so \
-DOPENGL_glu_LIBRARY:FILEPATH=/usr/lib64/libGLU.so \
-DOPENGL_glx_LIBRARY:FILEPATH=/usr/nvidia/lib64/libGLX.so \
-DOPENGL_opengl_LIBRARY:FILEPATH=/usr/nvidia/lib64/libOpenGL.so \
-DOpenGL_GL_PREFERENCE=GLVND \
-DWITH_OPENJPEG:BOOL=ON \
-DWITH_OPENMP:BOOL=OFF \
-DWITH_PNG:BOOL=ON \
-DBUILD_PROTOBUF:BOOL=ON \
-DWITH_PROTOBUF:BOOL=ON \
-DWITH_PTHREADS_PF:BOOL=ON \
-DWITH_QT:BOOL=ON \
-DWITH_TIFF:BOOL=ON \
-DWITH_V4L:BOOL=OFF \
-DWITH_VA:BOOL=ON \
-DWITH_VA_INTEL:BOOL=ON \
-DWITH_VTK:BOOL=ON \
-DWITH_GDAL:BOOL=OFF \
-DWITH_VULKAN:BOOL=ON \
-DWITH_WEBP:BOOL=ON \
-DOPENCV_EXTRA_MODULES_PATH=/builddir/build/BUILD/opencv/opencv_contrib/modules/ \
-DENABLE_COVERAGE:BOOL=OFF \
-DENABLE_BUILD_HARDENING:BOOL=OFF \
-DINSTALL_C_EXAMPLES:BOOL=OFF \
-DINSTALL_PYTHON_EXAMPLES:BOOL=OFF \
-DINSTALL_TESTS:BOOL=OFF \
-DBUILD_EXAMPLES:BOOL=OFF \
-DBUILD_PERF_TESTS:BOOL=ON \
-DBUILD_TESTS:BOOL=OFF \
-DBUILD_opencv_python_tests:BOOL=OFF \
-DBUILD_opencv_apps=ON
## make_macro content
ninja --verbose
## make_macro end

#ctest -j16 --verbose --progress --timeout 300 || :
exit 1
export OPENCV_TEST_DATA_PATH=/builddir/build/BUILD/opencv/opencv_extra/testdata
python modules/ts/misc/run.py clr-build/ --perf_force_samples=1
# bin/opencv_perf_core || :
# bin/opencv_perf_imgproc || :
# bin/opencv_perf_dnn || :
# bin/opencv_perf_stitching || :
# bin/opencv_perf_features2d || :
# bin/opencv_perf_superres || :
find . -type f,l -not -name '*.gcno' -not -name 'statuspgo*' -delete -print
echo USED > statuspgo
fi
if [ -f statuspgo ]; then
echo PGO Phase 2
export CFLAGS="${CFLAGS_USE}"
export CXXFLAGS="${CXXFLAGS_USE}"
export FFLAGS="${FFLAGS_USE}"
export FCFLAGS="${FCFLAGS_USE}"
export LDFLAGS="${LDFLAGS_USE}"
%cmake .. -GNinja \
-DBUILD_SHARED_LIBS:BOOL=OFF \
-DCMAKE_BUILD_TYPE=Release \
-DCMAKE_C_COMPILER=/usr/bin/gcc \
-DCMAKE_CXX_COMPILER=/usr/bin/g++ \
-DCMAKE_AR=/usr/bin/gcc-ar \
-DCMAKE_NM=/usr/bin/gcc-nm \
-DCMAKE_RANLIB=/usr/bin/gcc-ranlib \
-DCMAKE_INSTALL_LIBDIR:PATH=/usr/lib64 \
-DCMAKE_INSTALL_PREFIX=/usr \
-DCMAKE_JOB_POOL_COMPILE=full_jobs \
-DCMAKE_JOB_POOL_LINK=full_jobs \
-DCMAKE_JOB_POOLS=full_jobs=16 \
-DCMAKE_VERBOSE_MAKEFILE:BOOL:BOOL=ON \
-Dverbose:BOOL=ON \
-DVERBOSE:BOOL=ON \
-DVERBOSE=1 \
-DBUILD_opencv_python2:BOOL=OFF \
-DHAVE_opencv_python2:BOOL=OFF \
-DBUILD_opencv_python3:BOOL=ON \
-DHAVE_opencv_python3:BOOL=ON \
-DBUILD_opencv_java:BOOL=OFF \
-DCPU_BASELINE=AVX2 \
-DCPU_DISPATCH= \
-DCV_DISABLE_OPTIMIZATION:BOOL=OFF \
-DCV_ENABLE_INTRINSICS:BOOL=ON \
-DCV_TRACE:BOOL=OFF \
-DBUILD_DOCS:BOOL=OFF \
-DENABLE_CCACHE:BOOL=OFF \
-DENABLE_FAST_MATH:BOOL=OFF \
-DENABLE_PIC:BOOL=ON \
-DWITH_TBB:BOOL=ON \
-DMKL_WITH_TBB:BOOL=ON \
-DMKL_USE_SINGLE_DYNAMIC_LIBRARY:BOOL=OFF \
-DMKL_WITH_OPENMP:BOOL=OFF \
-DBUILD_TBB:BOOL=OFF \
-DOPENCV_DNN_CUDA:BOOL=ON \
-DOPENCV_DNN_OPENCL:BOOL=ON \
-DOPENCV_ENABLE_NONFREE:BOOL=ON \
-DOPENCV_GENERATE_PKGCONFIG:BOOL=ON \
-DOPENCV_PYTHON_INSTALL_PATH=/usr/lib/python3.9/site-packages \
-DPYTHON3_EXECUTABLE:FILEPATH=/usr/bin/python3 \
-DPython2_EXECUTABLE= \
-DPYTHON2_EXECUTABLE= \
-DPARALLEL_ENABLE_PLUGINS:BOOL=ON \
-DBUILD_PNG:BOOL=OFF \
-DBUILD_JAVA:BOOL=OFF \
-DWITH_1394:BOOL=OFF \
-DWITH_ADE:BOOL=ON \
-DWITH_CUDA:BOOL=ON \
-DWITH_NGRAPH:BOOL=OFF \
-DCUDAToolkit_ROOT=/usr/local/cuda \
-DCUDNN_INCLUDE_DIR=/usr/local/cuda/include \
-DCUDA_NVCC_FLAGS="-O3;-Xptxas;-O3,-v;-cudart=static;-Xcompiler;-O3,-march=native,-fuse-linker-plugin,-ffat-lto-objects,-fasynchronous-unwind-tables,-pthread,-static-libstdc++,-static-libgcc;-Xlinker;-O3,-march=native,-fuse-linker-plugin,-ffat-lto-objects,-fasynchronous-unwind-tables,-pthread,-static-libstdc++,-static-libgcc;-Xarchive;-O3,-march=native,-fuse-linker-plugin,-ffat-lto-objects,-fasynchronous-unwind-tables,-pthread,-static-libstdc++,-static-libgcc" \
-DCUDA_ARCH_BIN=5.2 \
-DCUDA_HOST_COMPILER=/usr/bin/gcc-10 \
-DCUDA_PROPAGATE_HOST_FLAGS:BOOL=OFF \
-DCUDA_VERBOSE_BUILD:BOOL=ON \
-DWITH_EIGEN:BOOL=ON \
-DWITH_FFMPEG:BOOL=ON \
-DWITH_FREETYPE:BOOL=ON \
-DWITH_GSTREAMER:BOOL=ON \
-DWITH_GTK:BOOL=OFF \
-DWITH_IMGCODEC_HDR:BOOL=ON \
-DWITH_IMGCODEC_PFM:BOOL=ON \
-DWITH_IMGCODEC_PXM:BOOL=ON \
-DWITH_IMGCODEC_SUNRASTER:BOOL=ON \
-DBUILD_IPP_IW:BOOL=OFF \
-DWITH_IPP:BOOL=ON \
-DIPPROOT=/aot/intel/oneapi/ipp/latest/ \
-DBUILD_WITH_DYNAMIC_IPP=OFF \
-DOPENCV_IPP_GAUSSIAN_BLUR:BOOL=ON \
-DWITH_ITT:BOOL=ON \
-DWITH_JASPER:BOOL=OFF \
-DWITH_JPEG:BOOL=ON \
-DWITH_LAPACK:BOOL=ON \
-DWITH_MFX:BOOL=OFF \
-DWITH_OPENCLAMDBLAS:BOOL=ON \
-DWITH_OPENCLAMDFFT:BOOL=ON \
-DWITH_OPENCL:BOOL=ON \
-DWITH_OPENCL_SVM:BOOL=ON \
-DWITH_OPENEXR:BOOL=OFF \
-DWITH_OPENGL:BOOL=ON \
-DOPENGL_egl_LIBRARY:FILEPATH=/usr/nvidia/lib64/libEGL.so \
-DOPENGL_gl_LIBRARY:FILEPATH=/usr/nvidia/lib64/libGL.so \
-DOPENGL_gles2_LIBRARY:FILEPATH=/usr/nvidia/lib64/libGLESv2.so \
-DOPENGL_gles3_LIBRARY:FILEPATH=/usr/nvidia/lib64/libGLESv2.so \
-DOPENGL_glu_LIBRARY:FILEPATH=/usr/lib64/libGLU.so \
-DOPENGL_glx_LIBRARY:FILEPATH=/usr/nvidia/lib64/libGLX.so \
-DOPENGL_opengl_LIBRARY:FILEPATH=/usr/nvidia/lib64/libOpenGL.so \
-DOpenGL_GL_PREFERENCE=GLVND \
-DWITH_OPENJPEG:BOOL=ON \
-DWITH_OPENMP:BOOL=OFF \
-DWITH_PNG:BOOL=ON \
-DBUILD_PROTOBUF:BOOL=ON \
-DWITH_PROTOBUF:BOOL=ON \
-DWITH_PTHREADS_PF:BOOL=ON \
-DWITH_QT:BOOL=ON \
-DWITH_TIFF:BOOL=ON \
-DWITH_V4L:BOOL=OFF \
-DWITH_VA:BOOL=ON \
-DWITH_VA_INTEL:BOOL=ON \
-DWITH_VTK:BOOL=ON \
-DWITH_GDAL:BOOL=OFF \
-DWITH_VULKAN:BOOL=ON \
-DWITH_WEBP:BOOL=ON \
-DOPENCV_EXTRA_MODULES_PATH=/builddir/build/BUILD/opencv/opencv_contrib/modules/ \
-DENABLE_COVERAGE:BOOL=OFF \
-DENABLE_BUILD_HARDENING:BOOL=OFF \
-DINSTALL_C_EXAMPLES:BOOL=OFF \
-DINSTALL_PYTHON_EXAMPLES:BOOL=OFF \
-DINSTALL_TESTS:BOOL=OFF \
-DBUILD_EXAMPLES:BOOL=OFF \
-DBUILD_PERF_TESTS:BOOL=OFF \
-DBUILD_TESTS:BOOL=OFF \
-DBUILD_opencv_python_tests:BOOL=OFF \
-DBUILD_opencv_apps=ON
## make_macro content
ninja --verbose
## make_macro end
fi
popd

%install
export SOURCE_DATE_EPOCH=1622546877
rm -rf %{buildroot}
pushd clr-build
%ninja_install
popd
## install_append content
# A bad idea but this will allow things that use pkgconfig to use opencv4
# Probably remove at some point once software updates build detection for new upstream release
cp %{buildroot}/usr/lib64/pkgconfig/opencv4.pc %{buildroot}/usr/lib64/pkgconfig/opencv.pc || :
install -dm 0755 %{buildroot}/usr/lib64/haswell/ || :
cp --archive %{buildroot}/usr/lib64/lib*.so* %{buildroot}/usr/lib64/haswell/ || :
## install_append end

%files
%defattr(-,root,root,-)
